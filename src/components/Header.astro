---
import { Icon } from 'astro-icon'
import ThemeSwitcher from '~/components/theme-switcher.astro'
import type { NavItem } from '~/types'
import logo2gt from '~/icons/logo2gt.png'

interface Props
{
	id?: string | undefined;
	fixedHeader?: boolean
}

const {
	id = undefined,
	fixedHeader = true,
} = Astro.props

const navItems: Array<NavItem> = [
	{ title: 'Accueil', url: '/' },
	{ title: 'L\'asso', url: '/#asso' },
	{ title: 'La Communaut√©', url: '/#community' },
	{ title: 'Nous', url: '/about' },
]

const headerClass = 'header' + (fixedHeader ? ' fixed-header' : '')
---

<header id={id} class={headerClass} data-fixed-header={fixedHeader}>
	<a class="flex items-center gap-3 hover:!text-default" href="/">
		<h1 class="sr-only">2GETHER</h1>
		<img src={logo2gt} id="logo2gt" class="h-10" />
	</a>
	<div>
		<div class="flex items-center gap-6">
			<nav class="hidden sm:block">
				<ul class="flex items-center gap-6">
					{
						navItems.map(({ title, url }) => (
							<li>
								<a class="text-sm" href={url}>
									{title}
								</a>
							</li>
						))
					}
				</ul>
			</nav>

			<button type="button" class="btn sm:hidden" aria-label="Navigation" data-open-nav>
				<Icon pack="mdi" name="menu" class="h-8" />
			</button>
			<ThemeSwitcher />
		</div>
		<div class="hidden menu-modal modal" aria-hidden="true">
			<div class="fixed inset-0 bg-default px-8 py-4 text-default">
				<div class="space-y-4" role="dialog" aria-modal="true">
					<header class="text-right">
						<button type="button" class="btn" aria-label="Close navigation" data-close-nav>
							<Icon pack="mdi" name="close" class="h-8" />
						</button>
					</header>
					<div class="flex justify-center">
						<img src={logo2gt} id="logo2gt" class="h-16" />
					</div>
					<nav>
						<ul class="flex flex-col">
							{
								navItems.map(({ title, url }) => (
									<li>
										<a class="block py-4 text-center text-xl" href={url}>
											{title}
										</a>
									</li>
								))
							}
					</ul>
					</nav>
				</div>
			</div>
		</div>
	</div>
</header>

<script>
	const headers: NodeListOf<HTMLElement> = document.querySelectorAll('.header')
	const root = document.documentElement

	headers.forEach(header =>
		{
			// Fix header on scroll
			document.addEventListener('scroll', () =>
				{
					if (header.hasAttribute('data-fixed-header'))
					{
						return
					}

					const d = root.clientHeight - root.scrollTop - header.offsetHeight
					header.classList.toggle('fixed-header', d < 0)
				})

			const menuModal = header.querySelector('.menu-modal')
			const menuModalNav = menuModal.querySelectorAll('nav')
			const openNavButtons = header.querySelectorAll('[data-open-nav]')
			const closeNavButtons = header.querySelectorAll('[data-close-nav]')

			const openMenu = () =>
				{
					menuModal.classList.remove('hidden')
				}

			const closeMenu = () =>
				{
					menuModal.classList.add('hidden')
				}

			openNavButtons.forEach(btn => btn.addEventListener('click', openMenu))
			closeNavButtons.forEach(btn => btn.addEventListener('click', closeMenu))

			menuModalNav.forEach(nav =>
				nav.addEventListener('click', event =>
				{
					if ((event.target as HTMLElement).tagName === 'A')
					{
						closeMenu()
					}
				}))
		})
</script>

<noscript>
	<style lang="scss">
		#open-nav-button {
			display: none;
		}
	</style>
</noscript>

<style lang="scss">
	.header {
		@apply absolute bottom-0 z-50;
		@apply flex items-center justify-between;
		@apply w-full px-8 py-4;
		@apply text-white;
		@apply border-b border-transparent;

		&.fixed-header {
			@apply fixed top-0 bottom-auto;
			@apply border-default bg-default text-default;
		}
	}

	.modal.is-open {
		@apply block;
	}
</style>
